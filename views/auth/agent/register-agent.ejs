<% contentFor('style') %>
<link rel="stylesheet" href="/plugins/select2/dist/css/select2.min.css" />
<link rel="stylesheet" href="/css/persian-datepicker.min.css" />
<link rel="stylesheet" href="/css/select2.css" />
<link rel="stylesheet" href="/css/profilepicker.css" />
<link rel="stylesheet" href="/css/radio.css" />
<link rel="stylesheet" href="/css/agent-auth.css" />
<link href="https://static.neshan.org/sdk/leaflet/1.4.0/leaflet.css" rel="stylesheet" type="text/css">
<script src="https://static.neshan.org/sdk/leaflet/1.4.0/leaflet.js" type="text/javascript"></script>

<style>
	.container {
		width: 100% !important;
		height: 100% !important;
	}
</style>

<% contentFor('body') %>
<!--? Main Content -->
<section class="container">
	<section class="card">
		<!--? Card Body -->
		<div class="card-body">
			<div class="alert alert-warning" role="alert">
				پر کردن موارد ستاره دار الزامی است!
				<i class="fas fa-info-circle" style="margin-left: 20px; font-size: 1.5rem;"></i>
			</div>
			<form class="form-horizontal content" action="/auth/agent/register?_csrf=<%= req.csrfToken() %>"
				method="post" enctype="multipart/form-data">
				<%- include(viewPath('layouts/errors')) -%>

				<input name="mobile" type="text" value="<%= mobile %>" readonly hidden />

				<input name="code" type="text" value="<%= code %>" readonly hidden />

				<!--? Profile Picker -->
				<label>انتخاب لوگو املاک</label>
				<div class="col-xs-4">
					<div class="small-12 medium-2 large-2 columns">
						<div class="logo-circle">
							<img id="logo" class="logo-pic" src="/images/logo-placeholder.png" />
						</div>
						<div class="l-image">
							<i class="fa fa-camera upload-logo-button"></i>
							<i class="fa fa-remove remove-logo-button"></i>
							<input name="logo" class="logo-upload" type="file" accept="image/*" hidden />
						</div>
					</div>
				</div>
				<!--! Profile Picker -->

				<!--? Select Avatar -->
				<label>انتخاب آواتار کاربر مدیر</label>
				<div class="content-group">
					<div class="row">
						<!--? Profile Picker -->
						<div class="col-xs-4">
							<div class="small-12 medium-2 large-2 columns">
								<div class="profile-circle">
									<img id="profile" class="profile-pic" src="/images/profile.png" />
								</div>
								<div class="p-image">
									<i class="fa fa-camera upload-profile-button"></i>
									<i class="fa fa-remove remove-profile-button"></i>
									<input name="profile" class="profile-upload" type="file" accept="image/*" hidden />
								</div>
							</div>
						</div>
						<!--! Profile Picker -->
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" name="avatar" class="radio-select" value="/images/avatar-01.png"
									checked />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-01.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" class="radio-select" name="avatar" value="/images/avatar-02.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-02.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" name="avatar" class="radio-select" value="/images/avatar-03.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-03.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" class="radio-select" name="avatar" value="/images/avatar-04.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-04.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" name="avatar" class="radio-select" value="/images/avatar-06.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-06.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" class="radio-select" name="avatar" value="/images/avatar-05.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-05.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" name="avatar" class="radio-select" value="/images/avatar-07.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-07.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" class="radio-select" name="avatar" value="/images/avatar-08.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-08.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" name="avatar" class="radio-select" value="/images/avatar-09.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-09.png" class="img-avatar" />
							</label>
						</div>
						<div class="col-xs-4">
							<label class="radio">
								<input type="radio" name="avatar" class="radio-select" value="/images/avatar-10.png" />
								<span class="radio-checkmark"></span>
								<img src="/images/avatar-10.png" class="img-avatar" />
							</label>
						</div>
					</div>
				</div>
				<!--! Select Avatar -->

				<div class="col-md-12" style="display: flex; flex-wrap: wrap;">
					<div class="col-md-6">
						<input name="name" type="text" class="form-control formObject"
							placeholder="نام و نام خانوادگی مدیر *" value="<%= complete('name') %>" />
					</div>
					<div class="col-md-6">
						<input name="title" type="text" class="form-control formObject" placeholder="نام دفتر املاک *"
							value="<%= complete('title') %>" />
					</div>
				</div>

				<div class="col-md-12" style="display: flex; flex-wrap: wrap;">
					<div class="col-md-6">
						<input name="email" type="text" class="form-control formObject" placeholder="آدرس ایمیل"
							value="<%= complete('email') %>" style="text-align: left; direction: ltr;" />
					</div>
					<div class="col-md-6">
						<input name="tell" maxlength="11" type="text" style="text-align: left; direction: ltr;"
							dir="ltr" class="form-control formObject" placeholder="تلفن ثابت"
							value="<%= complete('tell') %>" />
					</div>
				</div>

				<div class="col-md-12" style="display: flex; flex-wrap: wrap;">
					<div class="col-md-6">
						<div class="input-group">
							<div class="input-group-prepend">
								<span style="cursor: pointer; border: 0;" class="input-group-text formObject">
									<i toggle="#password" class="fa fa-fw fa-eye-slash field-icon toggle-password"></i>
								</span>
							</div>
							<input id="password" style="text-align: left; direction: ltr;" name="password"
								type="password" class="form-control formObject" placeholder="رمز عبور *"
								value="<%= complete('password') %>" />
						</div>
					</div>
					<div class="col-md-6">
						<div class="input-group">
							<div class="input-group-prepend">
								<span style="cursor: pointer; border: 0;" class="input-group-text formObject">
									<i toggle="#repeatPassword"
										class="fa fa-fw fa-eye-slash field-icon toggle-password"></i>
								</span>
							</div>
							<input id="repeatPassword" style="text-align: left; direction: ltr ;" name="repeatPassword"
								type="password" class="form-control formObject" placeholder="تکرار رمز عبور *"
								value="<%= complete('repeatPassword') %>" />
						</div>
					</div>
				</div>

				<div class="col-md-12" style="display: flex; flex-wrap: wrap;">
					<div class="col-md-4">
						<div class="form-group">
							<label>استان</label>
							<select class="form-control select" id="state" name="state">
								<% states.forEach(state => { %>
								<option value="<%= state._id %>"><%= state.title %></option>
								<% }) %>
							</select>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>شهر</label>
							<select class="form-control select" id="city" name="city"></select>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>ناحیه</label>
							<select class="form-control select" id="region" name="region"></select>
						</div>
					</div>
				</div>

				<input name="address" type="text" class="form-control formObject" placeholder="آدرس *"
					value="<%= complete('address') %>" />

				<label>انتخاب موقعیت مکانی بر روی نقشه</label>
				<div style="margin-top: 15px; display: none;">
					<input id="lat" name="lat" type="text" value="<%= complete('lat') %>" />
					<input id="lon" name="lon" type="text" value="<%= complete('lon') %>" />
				</div>
				<div id="map"
					style="min-height: 350px; width:100%; background: #eee; border: 2px solid #aaa; margin-bottom: 15px;">
				</div>

				<button type="submit" class="btn btn-danger formObject">
					ثبت
				</button>
			</form>
		</div>
		<!--! Card Body -->
	</section>
</section>
<!--! Main Content -->

<% contentFor('script') %>
<script src="/plugins/jquery/dist/jquery.min.js"></script>
<script src="/plugins/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/persian-date.min.js"></script>
<script src="/js/persian-datepicker.min.js"></script>
<script src="/plugins/select2/dist/js/select2.full.min.js"></script>
<script src="/js/select2.js"></script>
<script src="/js/profilepicker.js"></script>
<script src="/js/logopicker.js"></script>
<script src="/js/datepicker.js"></script>
<script src="/js/fetch.js"></script>

<script>
	var myMap = new L.Map('map', {
		key: 'web.VoTGvNjZqrBisGIHnHGVAPy7iMe2QrTQiwNOShxh',
		maptype: 'neshan',
		center: [35.699739, 51.338097],
		zoom: 14
	});

	$('.leaflet-container').css('cursor', 'crosshair');

	var marker = null;
	myMap.on('click', function (e) {
		if (marker != null)
			myMap.removeLayer(marker)
		marker = new L.Marker(e.latlng).addTo(myMap);
		document.getElementById("lat").value = e.latlng.lat;
		document.getElementById("lon").value = e.latlng.lng;
		document.getElementById("btn-loc").innerHTML = e.latlng.lat + ' , ' + e.latlng.lng;
	});

	const CITY_URL = '/auth/agent/city?_csrf=<%= req.csrfToken() %>';
	const REGION_URL = '/auth/agent/region?_csrf=<%= req.csrfToken() %>';

	$(document).ready(async function () {
		let stateId = $('#state option:selected').val();
		await postData(CITY_URL, { id: stateId }).then((data) => {
			data.map((city) => {
				$('#city').append(`<option value="${city._id}">${city.title}</option>`);
			});
		});

		let cityId = $('#city option:selected').val();
		await postData(REGION_URL, { id: cityId }).then((data) => {
			data.map((region) => {
				$('#region').append(`<option value="${region._id}">${region.title}</option>`);
			});
		});
	});

	$('#state').change(async () => {
		let stateId = $('#state option:selected').val();
		$('#city option').remove();
		await postData(CITY_URL, { id: stateId }).then((data) => {
			data.map((city) => {
				$('#city').append(`<option value="${city._id}">${city.title}</option>`);
			});
		});

		let cityId = $('#city option:selected').val();
		$('#region option').remove();
		await postData(REGION_URL, { id: cityId }).then((data) => {
			data.map((region) => {
				$('#region').append(`<option value="${region._id}">${region.title}</option>`);
			});
		});
	});

	$('#city').change(() => {
		let id = $('#city option:selected').val();
		$('#region option').remove();
		postData(REGION_URL, { id }).then((data) => {
			data.map((region) => {
				$('#region').append(`<option value="${region._id}">${region.title}</option>`);
			});
		});
	});

	$('.toggle-password').click(function () {
		$(this).toggleClass('fa-eye fa-eye-slash');
		var input = $($(this).attr('toggle'));
		if (input.attr('type') == 'password') {
			input.attr('type', 'text');
		} else {
			input.attr('type', 'password');
		}
	});
</script>